

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logging &#8212; python201 0.0.1 documentation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Performance" href="performance.html" />
    <link rel="prev" title="Command-line Interfaces" href="commandline.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">

    
    <a class="navbar-brand" href="../index.html">
      <img src="../_static/logo.png" class="logo" alt="logo">
    </a>
    
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="../setup.html">Setup</a>
        </li>
        
        <li class="nav-item active">
            <a class="nav-link" href="index.html">Tutorial</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../references.html">References</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../license.html">License</a>
        </li>
        
        
      </ul>


      

      <ul class="navbar-nav">
        
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/glentner/python201" target="_blank" rel="noopener">
              <span><i class="fab fa-github-square"></i></span>
            </a>
          </li>
        
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar">

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>


<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

  <div class="bd-toc-item active">
  

  <ul class="nav bd-sidenav">
      
      
      
      
        
          
              <li class="">
                  <a href="packaging.html">Packaging</a>
              </li>
          
        
          
              <li class="">
                  <a href="testing.html">Testing</a>
              </li>
          
        
          
              <li class="">
                  <a href="documentation.html">Documentation</a>
              </li>
          
        
          
              <li class="">
                  <a href="commandline.html">Command-line Interfaces</a>
              </li>
          
        
          
              <li class="active">
                  <a href="">Logging</a>
              </li>
          
        
          
              <li class="">
                  <a href="performance.html">Performance</a>
              </li>
          
        
      
      
      
      
      
      
    </ul>

</nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#print-statements" class="nav-link">Print Statements</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#conventions" class="nav-link">Conventions</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#logging-level" class="nav-link">Logging Level</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#logging-output" class="nav-link">Logging Output</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#what-to-include" class="nav-link">What to Include</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#logging-in-python" class="nav-link">Logging in Python</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#overview" class="nav-link">Overview</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#module-level-logging" class="nav-link">Module Level Logging</a>
        </li>
    
            </ul>
        </li>
    
    </ul>
</nav>


              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="logging">
<span id="logging-section"></span><h1>Logging<a class="headerlink" href="#logging" title="Permalink to this headline">¶</a></h1>
<p>In scientific/research computing, especially in high-performance computing when you’re running
many jobs with a batch system, it’s a good idea to include logging in your libraries and tools. If
you’re running many tasks that are meant to occur in a particular sequence, especially if multiple
such workflows are occurring asynchronously across more than one machine, having detailed logs to
review (manually or automatically by another tool) is a powerful way of managing workloads.</p>
<div class="section" id="print-statements">
<h2>Print Statements<a class="headerlink" href="#print-statements" title="Permalink to this headline">¶</a></h2>
<p>You can print out either a message or the value of some variable, etc., while your code is
running. This is quite common and is usually accomplished with a simple call to the <code class="docutils literal notranslate"><span class="pre">print</span></code>
function.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="n">x</span> <span class="o">=</span> <span class="mf">1.234</span>

<span class="gp">In [2]: </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;x is </span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="go">x is 1.234</span>
</pre></div>
</div>
<p>Doing this is a good idea to keep track of milestones in your code. That way, both when you are
developing your code but also when other users are running the code, they can be notified of an
event, progress, or value.</p>
<p>It’s also typical for novice programmers to attempt a simple form of debugging where print
statements are inserted throughout the program to track behavior or data to verify things are
working as they should. The issue is that these statements are hastily inserted when things aren’t
as they should be and then just as hastily removed afterward. A better approach would be to have a
mechanism by which messages could be included programmatically upon request but suppressed
otherwise.</p>
</div>
<div class="section" id="conventions">
<h2>Conventions<a class="headerlink" href="#conventions" title="Permalink to this headline">¶</a></h2>
<p>A <cite>log</cite> is a record of some event or action. In software, logging is the act of keeping a record
of the events and actions done by a program. There are two defining characteristics that
distinguish logging from simple print statements. Messages emitted by the logger can automatically
have additional metadata attached. Further, messages should be filterable based on severity such
that messages below a given level of severity can be suppressed.</p>
<p>Several common attributes (metadata) are typically included in logging messages. Which ones you
should include in your logging setup is a matter of use-case and preference. The following are
things you should consider.</p>
<div class="section" id="logging-level">
<h3>Logging Level<a class="headerlink" href="#logging-level" title="Permalink to this headline">¶</a></h3>
<p>As stated, one of the core features of logging is that you should be able to control which
messages are printed as a matter of category. These categories are usually a reference to the
level of severity of the message. There is always a numeric value and a name for a logging level.</p>
<p>Conventionally you have a subset or a superset of the following levels.</p>
<ol class="arabic simple">
<li><p><strong>DEBUG</strong>    - Supplemental messages typically only used when something is wrong.</p></li>
<li><p><strong>INFO</strong>     - General purposes messages for tracking progress.</p></li>
<li><p><strong>WARNING</strong>  - Something unexpected has occurred and may be important.</p></li>
<li><p><strong>ERROR</strong>    - A problem has occurred and a task cannot be completed.</p></li>
<li><p><strong>CRITICAL</strong> - The code or application must halt.</p></li>
</ol>
<p>These particular levels are not required, they are merely conventional. As we’ll see in a moment,
Python automatically supports these levels as described. Some applications include additional
levels for more fine grained control. Completely different schemes are not unheard of either;
another common sort of approach for simple tools may be to just have <strong>OK</strong>/<strong>ERR</strong> messages
instead.</p>
<p>The important feature is that these levels are an ordered set. The numeric value of the level is
what is used to filter against. Setting a logging level of WARNING (i.e., 3) means that levels
below that (DEBUG and INFO) will be suppressed. This is meant to be a run-time option that lets
you include the statements in your code, but switch them off if not needed.</p>
<p>When printing statements, the name of the logging level (often in all-caps), is typically included
<cite>before</cite> the message.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>INFO - all done
</pre></div>
</div>
</div>
<div class="section" id="logging-output">
<h3>Logging Output<a class="headerlink" href="#logging-output" title="Permalink to this headline">¶</a></h3>
<p>There are many targets for outputting logs. Often, logs are simply printed (or redirected from)
the console, or written in plain text to a file. You might imagine having logs written to another
service over the network or maybe even a database. Sometimes, one doesn’t preclude the other.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Many software engineers have very strong opinions about what to do with logging output, how it
should be formatted, and where it should go. We’ll stick to the basics and not worry about
that too much for now.</p>
</div>
<p>We’ll assume that our messages should be printed as text in some controllable fashion. As discussed in
the previous section on command-line interfaces, you should print messages to <cite>stderr</cite>. This is if the
messages are going to the console; you might allow the user to instead specify a file path to write
the messages to.</p>
</div>
<div class="section" id="what-to-include">
<h3>What to Include<a class="headerlink" href="#what-to-include" title="Permalink to this headline">¶</a></h3>
<p>In addition to the logging level, you might want to include a few other things. Some good ones include
the timestamp for the message, a topic, and a hostname.</p>
<p>You should include a <strong>timestamp</strong> for your message so you have a record of when the event
occurred. It also might be the case that you are running more than one workflow at a time from
more than one program and it helps if they are all logging timestamps so you can merge them to get
an order of events. In this regard, it’s a good idea to include the timestamp at the very
beginning of the message so that you can combine output from multiple sources and sort it with
standard command-line tools.</p>
<p>You should include a <strong>topic</strong> in your message so that you can associate it with some part of your
library. It’s not always the case, but often this is done by tagging all your messages by which
module and/or function it came from. This can be done manually in the messages themselves, or
automatically by the framework you’re using. This can be very helpful in tracking down messages
pertaining to a particular part of your code.</p>
<p>You might want to include the <strong>hostname</strong> of the machine you’re running on. This is not as common
as other attributes, but in scientific computing the chances are high that you’re running your
workflow on many machines that are not your laptop. It might be useful to know what machine a
particular task ran on when analyzing your logs. This is easy to include automatically in most
logging frameworks.</p>
</div>
</div>
<div class="section" id="logging-in-python">
<h2>Logging in Python<a class="headerlink" href="#logging-in-python" title="Permalink to this headline">¶</a></h2>
<p>We’ve covered a lot of details here, but as with the previous section on command-line interfaces,
Python has you covered with a module from the standard library.</p>
<div class="section" id="overview">
<h3>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="https://docs.python.org/3/library/logging.html">logging</a> module is quite comprehensive and
allows the user to heavily customize many parts of the behavior. It is pretty strait forward to
implement your own logging functionality; unless you’re doing something special why not use the
standard library?</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">import</span> <span class="nn">logging</span>

<span class="gp">In [2]: </span><span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="gp">In [3]: </span><span class="n">log</span>
<span class="gh">Out[3]: </span><span class="go">&lt;Logger __main__ (WARNING)&gt;</span>
</pre></div>
</div>
<p>Here we’ve started with a name (usable as a <cite>topic</cite>) and by default our logging level is WARNING.
Our filter works, but our formatting is simply the message for now.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [4]: </span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;hello, world&#39;</span><span class="p">)</span>

<span class="gp">In [5]: </span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;uh oh&#39;</span><span class="p">)</span>
<span class="go">uh oh</span>
</pre></div>
</div>
<p>We can alter the formatting of the messages that are written by creating a formatter object.
The formatter is an attribute of a <cite>handler</cite>. A logger object has zero or more handlers that
all are free to deal with messages in their own way. We’ll setup a stream handler to write to
stderr and add it to our logger.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [6]: </span><span class="n">handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>

<span class="gp">In [7]: </span><span class="n">handler</span>
<span class="gh">Out[7]: </span><span class="go">&lt;StreamHandler &lt;stderr&gt; (NOTSET)&gt;</span>

<span class="gp">In [8]: </span><span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> </span><span class="si">%(levelname)s</span><span class="s1"> [</span><span class="si">%(name)s</span><span class="s1">] </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="gp">In [9]: </span><span class="n">handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>

<span class="gp">In [10]: </span><span class="n">log</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

<span class="gp">In [11]: </span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;oh my&#39;</span><span class="p">)</span>
<span class="go">2020-07-26 15:35:49,497 WARNING [__main__] oh my</span>
</pre></div>
</div>
<p>We can change the level if we like to allow lower level message to come through.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [12]: </span><span class="n">log</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

<span class="gp">In [13]: </span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>
<span class="go">2020-07-26 15:41:33,491 INFO [__main__] hello</span>
</pre></div>
</div>
<p>There’s a way to have the logging library add an attribute so you can include the hostname in the
message as a named field, like <code class="docutils literal notranslate"><span class="pre">%(hostname)s</span></code>. This is a bit cumbersome and makes things more
complicated than we’d like at this point. An easy hack though is to literally just code it in.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [14]: </span><span class="kn">import</span> <span class="nn">socket</span>

<span class="gp">In [15]: </span><span class="n">HOST</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">()</span>

<span class="gp">In [16]: </span><span class="n">HOST</span>
<span class="gh">Out[16]: </span><span class="go">&#39;my_machine.local&#39;</span>

<span class="gp">In [17]: </span><span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;%(asctime)s </span><span class="si">{</span><span class="n">HOST</span><span class="si">}</span><span class="s1"> %(levelname)s [%(name)s] %(message)s&#39;</span><span class="p">)</span>

<span class="gp">In [18]: </span><span class="n">handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>

<span class="gp">In [19]: </span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;look at this&#39;</span><span class="p">)</span>
<span class="go">2020-07-26 15:46:09,422 my_machine.local INFO [__main__] look at this</span>
</pre></div>
</div>
</div>
<div class="section" id="module-level-logging">
<h3>Module Level Logging<a class="headerlink" href="#module-level-logging" title="Permalink to this headline">¶</a></h3>
<p>Let’s update our code to include logging. When you’re developing a Python package, you don’t want
to duplicate code in each module. Instead, let’s create some generic code in a <cite>logging</cite> module.
We could just add it right along side our existing module, but it might be a good idea to create a
distinct <cite>core</cite> sub-package for generic code separate from our business-logic. That way, we can
add things later (like configuration file handling) and not clutter our top-level API.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ tree .
.
├── docs/
│   ├── build/
│   │   └── ...
│   ├── source/
│   │   ├── conf.py
│   │   ├── manpage.rst
│   │   └── index.rst
│   ├── Makefile
│   └── make.bat
├── LICENSE
├── python201/
│   ├── __init__.py
│   ├── algorithms.py
<span class="hll">│   └── core/
</span><span class="hll">│       ├── __init__.py
</span><span class="hll">│       └── logging.py
</span>├── README.rst
└── setup.py
</pre></div>
</div>
<p>Again, the <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> file is a signal that this folder is a package (or sub-package).
The <code class="docutils literal notranslate"><span class="pre">find_packages</span></code> function we used in our <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> will automatically pick this up so
we don’t need to worry about modifying any code there.</p>
<p>Our <code class="docutils literal notranslate"><span class="pre">logging</span></code> module might look something like this.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">python201/core/logging.py</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">logging</span> <span class="kn">import</span> <span class="n">DEBUG</span><span class="p">,</span> <span class="n">INFO</span><span class="p">,</span> <span class="n">WARNING</span><span class="p">,</span> <span class="n">ERROR</span><span class="p">,</span> <span class="n">CRITICAL</span>
<span class="kn">from</span> <span class="nn">socket</span> <span class="kn">import</span> <span class="n">gethostname</span>


<span class="n">HOST</span> <span class="o">=</span> <span class="n">gethostname</span><span class="p">()</span>
<span class="n">handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
<span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;%(asctime)s </span><span class="si">{</span><span class="n">HOST</span><span class="si">}</span><span class="s1"> %(levelname)s [%(name)s] %(message)s&#39;</span><span class="p">)</span>
<span class="n">handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">getLogger</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;warning&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a named logger.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        name (str): name for the logger</span>
<span class="sd">        level (str): logging level (default=&#39;warning&#39;)</span>

<span class="sd">    Returns:</span>
<span class="sd">        logger (`logging.getLogger`): the created logger instance</span>

<span class="sd">    See Also:</span>
<span class="sd">        `logging.getLogger`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">log</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
    <span class="n">log</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">logging</span><span class="p">,</span> <span class="n">level</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
    <span class="k">return</span> <span class="n">log</span>
</pre></div>
</div>
</div>
<p>We only need to create the handler once. But we want to allow each of the modules in our package
to create a new logger with a distinct name. So we’ve created a new function with the same name
as the underlying logging library to let us automatically add the handler added.</p>
<p>Now let’s modify the <code class="docutils literal notranslate"><span class="pre">algorithms</span></code> module to make use of our logging module.</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">python201/algorithms.py</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">from</span> <span class="nn">argparse</span> <span class="kn">import</span> <span class="n">ArgumentParser</span><span class="p">,</span> <span class="n">FileType</span>

<span class="hll"><span class="kn">from</span> <span class="nn">.core.logging</span> <span class="kn">import</span> <span class="n">getLogger</span><span class="p">,</span> <span class="n">DEBUG</span>
</span><span class="hll"><span class="n">log</span> <span class="o">=</span> <span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span>
<span class="k">def</span> <span class="nf">cumulative_product</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the cumulative product of an array of numbers.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        array (list): An array of numeric values.</span>

<span class="sd">    Returns:</span>
<span class="sd">        result (list): A list of the same shape as `array`.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; cumulative_product([1, 2, 3, 4, 5])</span>
<span class="sd">        [1, 2, 6, 24, 120]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
        <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">value</span>
<span class="hll">    <span class="n">sample</span> <span class="o">=</span> <span class="s1">&#39;[]&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;[..., </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">g</span><span class="si">}</span><span class="s1">]&#39;</span>
</span><span class="hll">    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;cumulative_product: length-</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="si">}</span><span class="s1"> array </span><span class="si">{</span><span class="n">sample</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span>    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">argv</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Command line entry-point for `cumulative_product`.&quot;&quot;&quot;</span>

    <span class="c1"># command line interface</span>
    <span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;Compute the cumulative product of an array of numbers.&#39;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">ArgumentParser</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="s1">&#39;cumprod&#39;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-v&#39;</span><span class="p">,</span> <span class="s1">&#39;--version&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;version&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;0.0.1&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;infile&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;FILE&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">FileType</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">),</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;input file path (default &lt;stdin&gt;)&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="s1">&#39;--output&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;outfile&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;FILE&#39;</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">FileType</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">),</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;output file path (default &lt;stdout&gt;)&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-l&#39;</span><span class="p">,</span> <span class="s1">&#39;--last-only&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;only keep the last value&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-d&#39;</span><span class="p">,</span> <span class="s1">&#39;--debug&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;show debugging messages&#39;</span><span class="p">)</span>
    <span class="n">cmdline</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>

<span class="hll">    <span class="k">if</span> <span class="n">cmdline</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span class="hll">        <span class="n">log</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">DEBUG</span><span class="p">)</span>
</span>
    <span class="n">values</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">cmdline</span><span class="o">.</span><span class="n">infile</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">cumulative_product</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>

    <span class="c1"># &#39;%g&#39; formatting automatically pretty-prints</span>
    <span class="n">start</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">cmdline</span><span class="o">.</span><span class="n">last_only</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">g</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="n">start</span><span class="p">:]]),</span> <span class="n">file</span><span class="o">=</span><span class="n">cmdline</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you’ve not seen that syntax before, the import statement for our <code class="docutils literal notranslate"><span class="pre">logging</span></code> module is
called a <cite>relative</cite> import. The leading dot means adjacent. If we had two leading dots it
would signify one level up, and so on. This way, we need not hard code the name of our
package.</p>
</div>
<p>Let’s reinstall our package and try it out.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ pip install . --upgrade
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ cumprod &lt;(seq 10) --last-only
3.6288e+06
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ cumprod &lt;(seq 10) --last-only --debug &gt;results.txt
2020-07-26 20:21:22,340 my_machine.local DEBUG [python201.algorithms] cumulative_product: length-10 array [..., 3.6288e+06]
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="commandline.html" title="previous page">Command-line Interfaces</a>
    <a class='right-next' id="next-link" href="performance.html" title="next page">Performance</a>

              </div>
              
          </main>
          

      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2019-2020 Geoffrey Lentner, 2018 Ashwin Srinath.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.1.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>