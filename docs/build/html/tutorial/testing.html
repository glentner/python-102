

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Testing &#8212; python201 0.0.1 documentation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Documentation" href="documentation.html" />
    <link rel="prev" title="Packaging" href="packaging.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">

    
    <a class="navbar-brand" href="../index.html">
      <img src="../_static/logo.png" class="logo" alt="logo">
    </a>
    
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="../setup.html">Setup</a>
        </li>
        
        <li class="nav-item active">
            <a class="nav-link" href="index.html">Tutorial</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../references.html">References</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../license.html">License</a>
        </li>
        
        
      </ul>


      

      <ul class="navbar-nav">
        
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/glentner/python201" target="_blank" rel="noopener">
              <span><i class="fab fa-github-square"></i></span>
            </a>
          </li>
        
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar">

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>


<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

  <div class="bd-toc-item active">
  

  <ul class="nav bd-sidenav">
      
      
      
      
        
          
              <li class="">
                  <a href="packaging.html">Packaging</a>
              </li>
          
        
          
              <li class="active">
                  <a href="">Testing</a>
              </li>
          
        
          
              <li class="">
                  <a href="documentation.html">Documentation</a>
              </li>
          
        
          
              <li class="">
                  <a href="commandline.html">Command-line Interfaces</a>
              </li>
          
        
          
              <li class="">
                  <a href="logging.html">Logging</a>
              </li>
          
        
          
              <li class="">
                  <a href="performance.html">Performance</a>
              </li>
          
        
      
      
      
      
      
      
    </ul>

</nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#testing-interactively" class="nav-link">Testing Interactively</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#test-scripts" class="nav-link">Test Scripts</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#assertions" class="nav-link">Assertions</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#automated-testing" class="nav-link">Automated Testing</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#useful-tests" class="nav-link">Useful Tests</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#fixing-the-code" class="nav-link">Fixing the Code</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#types-of-testing" class="nav-link">Types of Testing</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#test-driven-development" class="nav-link">Test-Driven Development</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#growing-a-useful-test-suite" class="nav-link">Growing a Useful Test Suite</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#extras" class="nav-link">Extras</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#hypothesis" class="nav-link">Hypothesis</a>
        </li>
    
            </ul>
        </li>
    
    </ul>
</nav>


              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="testing">
<span id="id1"></span><h1>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h1>
<p>Now that we’ve encapsulated our code in a well structured and installable package,
how can we validate that our code is robust and works as expected?</p>
<p><cite>We want to address the following …</cite></p>
<ul class="simple">
<li><p>How can you write modular, extensible, and reusable code?</p></li>
<li><p>After making changes to a program, how do you ensure that it will still give
the same answers as before?</p></li>
<li><p>How can we make finding and fixing bugs an easy, fun, and rewarding experience?</p></li>
</ul>
<p>These seemingly unrelated questions all have the same answer, and it is
<cite>automated testing</cite>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This section was originally based on Ned Batchelder’s
excellent article and PyCon 2014 talk
<a class="reference external" href="https://nedbatchelder.com/text/test0.html">Getting Started Testing</a>.</p>
<div class="line-block">
<div class="line">“<em>Tests are the dental floss of development: everyone knows they should do it more, but they don’t, and they feel guilty about it.</em>”</div>
<div class="line">- Ned Batchelder</div>
</div>
<div class="line-block">
<div class="line">“<em>Code without tests should be approached with a 10-foot pole.</em>”</div>
<div class="line">- Ashwin Srinath</div>
</div>
</div>
<div class="section" id="testing-interactively">
<h2>Testing Interactively<a class="headerlink" href="#testing-interactively" title="Permalink to this headline">¶</a></h2>
<p>Let’s look at our initial bit of code.</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">python201/algorithms.py</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cumulative_product</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">last_value</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">array</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="n">last_value</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
</div>
<p>While we were developing this function, we would have likely started up an IPython console and
either copied the code snippet or imported the function and tested it on a few simple cases to
validate that it returns expected results.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">from</span> <span class="nn">python201.algorithms</span> <span class="kn">import</span> <span class="n">cumulative_product</span>

<span class="gp">In [2]: </span><span class="n">cumulative_product</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="gh">Out[2]: </span><span class="go">[1, 2, 6]</span>

<span class="gp">In [3]: </span><span class="n">cumulative_product</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="gh">Out[3]: </span><span class="go">[3, 6, 6]</span>

<span class="gp">In [4]: </span><span class="n">cumulative_product</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="gh">Out[4]: </span><span class="go">[1, 2, 6, 24]</span>
</pre></div>
</div>
<p>While this kind of testing is better than not doing any testing at all, it leaves much to be
desired. First, it needs to be done each time <code class="docutils literal notranslate"><span class="pre">cumulative_product</span></code> is changed. It also requires
that we manually inspect the output from each test to decide if the code “passes” or “fails” that
test. Further, we need to remember all the tests we came up with today if we want to test again
tomorrow.</p>
</div>
<div class="section" id="test-scripts">
<h2>Test Scripts<a class="headerlink" href="#test-scripts" title="Permalink to this headline">¶</a></h2>
<p>A <cite>much</cite> better way to write tests is to put them in a script.</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">tests/test_algorithms.py</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">python201.algorithms</span> <span class="kn">import</span> <span class="n">cumulative_product</span>

<span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;cumulative_product(</span><span class="si">{</span><span class="n">array</span><span class="si">}</span><span class="s1">) ==&#39;</span><span class="p">,</span> <span class="n">cumulative_product</span><span class="p">(</span><span class="n">array</span><span class="p">))</span>

<span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;cumulative_product(</span><span class="si">{</span><span class="n">array</span><span class="si">}</span><span class="s1">) ==&#39;</span><span class="p">,</span> <span class="n">cumulative_product</span><span class="p">(</span><span class="n">array</span><span class="p">))</span>

<span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;cumulative_product(</span><span class="si">{</span><span class="n">array</span><span class="si">}</span><span class="s1">) ==&#39;</span><span class="p">,</span> <span class="n">cumulative_product</span><span class="p">(</span><span class="n">array</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>Now, running and re-running our tests is very easy - we just run the script.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python tests/test_algorithms.py
cumulative_product([1, 2, 3]) == [1, 2, 6]
cumulative_product([3, 2, 1]) == [3, 6, 6]
cumulative_product([1, 2, 3, 4]) == [1, 2, 6, 24]
</pre></div>
</div>
<p>It’s also easy to add new tests, and there’s no need to remember all the tests we come up with.</p>
</div>
<div class="section" id="assertions">
<h2>Assertions<a class="headerlink" href="#assertions" title="Permalink to this headline">¶</a></h2>
<p>One problem with the method above is that
we <em>still</em> need to manually inspect the results of our tests.</p>
<p>Assertions can help with this. The <code class="docutils literal notranslate"><span class="pre">assert</span></code> statement in Python is very simple: Given a
condition, like <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">==</span> <span class="pre">2</span></code>, it checks to see if the condition is true or false. If it is true,
then <code class="docutils literal notranslate"><span class="pre">assert</span></code> does nothing, and if it false, it raises an <code class="docutils literal notranslate"><span class="pre">AssertionError</span></code>.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="k">assert</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span>

<span class="gp">In [2]: </span><span class="k">assert</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="mi">2</span>

<span class="gp">In [3]: </span><span class="k">assert</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="mi">2</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AssertionError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="n">f53b9196f459</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="k">assert</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="mi">2</span>

<span class="ne">AssertionError</span>:
</pre></div>
</div>
<p>We can re-write our script as follows.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">tests/test_algorithms.py</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">python201.algorithms</span> <span class="kn">import</span> <span class="n">cumulative_product</span>

<span class="k">assert</span> <span class="n">cumulative_product</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">cumulative_product</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">cumulative_product</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">24</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>And we still run our tests the same way.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python tests/test_algorithms.py
</pre></div>
</div>
<p>This time, there’s no need to inspect the test results. If we get an <code class="docutils literal notranslate"><span class="pre">AssertionError</span></code>,
then we had a test fail; and if not, all our tests passed.</p>
<p>That said, there’s no way to know if <cite>more</cite> than one test failed. The script stops executing
after the first <code class="docutils literal notranslate"><span class="pre">AssertionError</span></code> is encountered. Let’s add another test to our test script and
re-run it.</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">tests/test_algorithms.py</span><a class="headerlink" href="#id6" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">python201.algorithms</span> <span class="kn">import</span> <span class="n">cumulative_product</span>

<span class="k">assert</span> <span class="n">cumulative_product</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">cumulative_product</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">cumulative_product</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">24</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">cumulative_product</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">18</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python tests/test_algorithms.py
Traceback (most recent call last):
  File &quot;tests/test_algorithms.py&quot;, line 8, in &lt;module&gt;
    assert cumulative_product([1, 2, 3, 3]) == [1, 2, 6, 18]
AssertionError
</pre></div>
</div>
<p>This time we get a failed test, because – as we said – our code is “bad”. Before adding
more tests to investigate, we’ll discuss one more method for running tests.</p>
</div>
<div class="section" id="automated-testing">
<h2>Automated Testing<a class="headerlink" href="#automated-testing" title="Permalink to this headline">¶</a></h2>
<p>A test runner takes a bunch of tests, executes them all, and then reports which of them passed
and which of them failed. A very popular test runner for Python is
<a class="reference external" href="https://docs.pytest.org/en/latest/">pytest</a>.</p>
<p>Like many testing frameworks, <code class="docutils literal notranslate"><span class="pre">pytest</span></code> can be quite sophisticated. For the purposes of
this tutorial, we’ll stick to the basics. Essentially, if you place all of your tests within
the appropriate layout, <code class="docutils literal notranslate"><span class="pre">pytest</span></code> will automatically find and execute all your tests.</p>
<p>We want all of our tests to live under files with names that start with <code class="docutils literal notranslate"><span class="pre">test</span></code> and we need all of our tests
to be encapsulated by functions whose names also start with <code class="docutils literal notranslate"><span class="pre">test</span></code>. A nice approach is to have a top
level <code class="docutils literal notranslate"><span class="pre">tests</span></code> folder in your project with a structure that mirrors your python package,
including a <code class="docutils literal notranslate"><span class="pre">test_X.py</span></code> partner for every module in your package.</p>
<p>In our case, we would have <code class="docutils literal notranslate"><span class="pre">tests/test_algorithms.py</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">tests/test_algorithms.py</span><a class="headerlink" href="#id7" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">python201.algorithms</span> <span class="kn">import</span> <span class="n">cumulative_product</span>

<span class="k">def</span> <span class="nf">test_cumulative_product</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">cumulative_product</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">cumulative_product</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">cumulative_product</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">24</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">cumulative_product</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">18</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>To run our tests, we simply execute <code class="docutils literal notranslate"><span class="pre">pytest</span></code> at the command line at the top of our
project.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ pytest
=================================== test session starts ====================================
platform linux -- Python 3.8.3, pytest-5.4.3, py-1.9.0, pluggy-0.13.1
rootdir: /home/glentner/code/github.com/glentner/python201
plugins: hypothesis-5.20.3
collected 1 item

tests/test_algorithms.py F                                                           [100%]

========================================= FAILURES =========================================
_________________________________ test_cumulative_product __________________________________

    def test_cumulative_product():
        assert cumulative_product([1, 2, 3]) == [1, 2, 6]
        assert cumulative_product([3, 2, 1]) == [3, 6, 6]
        assert cumulative_product([1, 2, 3, 4]) == [1, 2, 6, 24]
&gt;       assert cumulative_product([1, 2, 3, 3]) == [1, 2, 6, 18]
E       assert [1, 2, 6] == [1, 2, 6, 18]
E         Right contains one more item: 18
E         Use -v to get the full diff

tests/test_algorithms.py:9: AssertionError
================================= short test summary info ==================================
FAILED tests/test_algorithms.py::test_cumulative_product - assert [1, 2, 6] == [1, 2, 6, 18]
==================================== 1 failed in 0.21s =====================================
</pre></div>
</div>
<p>Pytest has found our test modules and run all our tests. Each module will be reported on its own
line. A <cite>dot</cite> will appear while it is running each test. An <code class="docutils literal notranslate"><span class="pre">F</span></code> is printed when a test fails
with a summary of what happened. Here we see that our final comparison failed and we are told
precisely what the problem is.</p>
</div>
<div class="section" id="useful-tests">
<h2>Useful Tests<a class="headerlink" href="#useful-tests" title="Permalink to this headline">¶</a></h2>
<p>Now that we know how to write and run tests, what kind of tests should we write?
Testing <code class="docutils literal notranslate"><span class="pre">cumulative_product</span></code> for arbitrary choices of inputs like <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2,</span> <span class="pre">3]</span></code>
might not tell us much about where the problem might be.</p>
<p>Instead, we should choose tests that exercise specific functionality of the code we are testing,
or represent different conditions that the code may be exposed to.</p>
<p>For example:</p>
<ul class="simple">
<li><p>An array of length 0 or 1.</p></li>
<li><p>An array of mixed sign or precision.</p></li>
<li><p>An array containing NaN values.</p></li>
</ul>
<p>In our case, it was even simpler than that; <cite>the existence of a value equal to that of the final
value prematurely truncates the sequence</cite>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Handling edge cases like those listed above are of course important, but even simple tests
that may seem silly are equally important sanity checks that will exercise your code when you
make changes.</p>
</div>
</div>
<div class="section" id="fixing-the-code">
<h2>Fixing the Code<a class="headerlink" href="#fixing-the-code" title="Permalink to this headline">¶</a></h2>
<p>Let’s rewrite our function to be a bit more <cite>Pythonic</cite> and without that troublesome bug.</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">python201/algorithms.py</span><a class="headerlink" href="#id8" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cumulative_product</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
        <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
</div>
<p>Not necessarily perfect, but clean and concise. Our intent is better expressed by the code
and we’ve become a bit more flexible with the possible input data types.
And we’ve eliminated the bug!</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">tests/test_algorithms.py</span><a class="headerlink" href="#id9" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">python201.algorithms</span> <span class="kn">import</span> <span class="n">cumulative_product</span>

<span class="k">def</span> <span class="nf">test_cumulative_product_simple</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">cumulative_product</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">cumulative_product</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">cumulative_product</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">24</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">cumulative_product</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">18</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">test_cumulative_product_empty</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">cumulative_product</span><span class="p">([])</span> <span class="o">==</span> <span class="p">[]</span>

<span class="k">def</span> <span class="nf">test_cumulative_product_starts_with_zero</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">cumulative_product</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)))</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">101</span>
</pre></div>
</div>
</div>
<p>Let’s run our tests again.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ pytest
================================== test session starts ===================================
platform linux -- Python 3.8.3, pytest-5.4.3, py-1.9.0, pluggy-0.13.1
rootdir: /home/glentner/code/github.com/glentner/python201
plugins: hypothesis-5.20.3
collected 3 items

tests/test_algorithms.py ...                                                       [100%]

=================================== 3 passed in 0.09s ====================================
</pre></div>
</div>
</div>
<div class="section" id="types-of-testing">
<h2>Types of Testing<a class="headerlink" href="#types-of-testing" title="Permalink to this headline">¶</a></h2>
<p>Software testing is a vast topic and there are
<a class="reference external" href="https://en.wikipedia.org/wiki/Software_testing">many levels and types</a>
of software testing. For scientific and
research software, the focus of testing efforts is primarily:</p>
<ol class="arabic simple">
<li><p><strong>Unit tests</strong>: Unit tests aim to test small, independent sections of code
(a function or parts of a function),
so that when a test fails,
the failure can easily be associated with that section of code.
This is the kind of testing that we have been doing so far.</p></li>
<li><p><strong>Regression tests</strong>: Regression tests aim to check whether
changes to the program result in it producing
different results from before.
Regression tests can test
larger sections of code
than unit tests.
As an example, if you are writing a machine learning application,
you may want to run your model on small data
in an automated way
each time your software undergoes changes,
and make sure that the same (or a better) result is produced.</p></li>
</ol>
</div>
<div class="section" id="test-driven-development">
<h2>Test-Driven Development<a class="headerlink" href="#test-driven-development" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Test-driven_development">Test-driven development (TDD)</a>
is the practice of writing tests for a function or method
<em>before</em> actually writing any code for that function or method.
The TDD process is to:</p>
<ol class="arabic simple">
<li><p>Write a test for a function or method</p></li>
<li><p>Write just enough code that the function or method passes that test</p></li>
<li><p>Ensure that all tests written so far pass</p></li>
<li><p>Repeat the above steps until you are satisfied with the code</p></li>
</ol>
<p>Proponents of TDD suggest that this results in better code.
Whether or not TDD sounds appealing to you,
writing tests should be <em>part</em> of your development process,
and never an afterthought.
In the process of writing tests,
you often come up with new corner cases for your code,
and realize better ways to organize it.
The result is usually code that is
more modular,
more reusable
and of course,
more testable,
than if you didn’t do any testing.</p>
<a class="reference external image-reference" href="https://en.wikipedia.org/wiki/Test-driven_development"><img alt="Test-Driven Development" src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/0b/TDD_Global_Lifecycle.png/1920px-TDD_Global_Lifecycle.png" /></a>
</div>
<div class="section" id="growing-a-useful-test-suite">
<h2>Growing a Useful Test Suite<a class="headerlink" href="#growing-a-useful-test-suite" title="Permalink to this headline">¶</a></h2>
<p>More tests are always better than less,
and your code should have as many tests as you are willing to write.
That being said,
some tests are more useful than others.
Designing a useful suite of tests is a challenge in itself,
and it helps to keep the following in mind when growing tests:</p>
<ol class="arabic simple">
<li><p><strong>Tests should run quickly</strong>: testing is meant to be done as often as possible.
Your entire test suite should complete in no more than a few seconds,
otherwise you won’t run your tests often enough for them to be useful.
Always test your functions or algorithms on very small and simple data;
even if in practice they will be dealing with more complex and large datasets.</p></li>
<li><p><strong>Tests should be focused</strong>: each test should exercise a small part of your code.
When a test fails,
it should be easy for you to
figure out which part of your program you need to focus debugging efforts on.
This can be difficult if your code isn’t modular,
i.e., if different parts of your code depend heavily on each other.
This is one of the reasons TDD is said to produce more modular code.</p></li>
<li><p><strong>Tests should cover all possible code paths</strong>: if your function has multiple code paths
(e.g., an <em>if-else</em> statement),
write tests that execute both the “if” part
and the “else” part.
Otherwise, you might have bugs in your code and still have all tests pass.</p></li>
<li><p><strong>Test data should include difficult and edge cases</strong>: it’s easy to
write code that only handles cases with well-defined inputs and outputs.
In practice however, your code may have to deal with
input data for which it isn’t clear what the behavior should be.
For example, what should <code class="docutils literal notranslate"><span class="pre">cumulative_product([])</span></code> return?
Make sure you write tests for such cases,
so that you force your code to handle them.</p></li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="extras">
<h2>Extras<a class="headerlink" href="#extras" title="Permalink to this headline">¶</a></h2>
<div class="section" id="hypothesis">
<h3>Hypothesis<a class="headerlink" href="#hypothesis" title="Permalink to this headline">¶</a></h3>
<p>Like many such frameworks, <code class="docutils literal notranslate"><span class="pre">pytest</span></code> has a plugin system that allows its functionality to be
extended by design. A notable package that works as a plugin for <code class="docutils literal notranslate"><span class="pre">pytest</span></code> is
<a class="reference external" href="https://hypothesis.readthedocs.io/en/latest/index.html">Hypothesis</a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">Hypothesis</span></code> implements <cite>property-based testing</cite> that allows you to write unit tests in a way
that isn’t hard-coded. You define strategies for given inputs and <code class="docutils literal notranslate"><span class="pre">hypothesis</span></code> automatically generates
entire ensembles of tests for a given definition including edge cases you would want to cover.</p>
<p>For our <cite>zero</cite> test, if the initial value of the array is zero, it simply doesn’t matter what the
remaining values of the array are, the result will be an array of the same length and all zeros.
So our test could use <code class="docutils literal notranslate"><span class="pre">hypothesis</span></code> to define a strategy that will test many cases without us
hard coding them.</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">tests/test_algorithms.py</span><a class="headerlink" href="#id10" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">hypothesis.strategies</span> <span class="kn">import</span> <span class="n">lists</span><span class="p">,</span> <span class="n">integers</span>
<span class="kn">from</span> <span class="nn">hypothesis</span> <span class="kn">import</span> <span class="n">given</span>

<span class="kn">from</span> <span class="nn">python201.algorithms</span> <span class="kn">import</span> <span class="n">cumulative_product</span>


<span class="k">def</span> <span class="nf">test_cumulative_product_simple</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">cumulative_product</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">cumulative_product</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">cumulative_product</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">24</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">cumulative_product</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">18</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">test_cumulative_product_empty</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">cumulative_product</span><span class="p">([])</span> <span class="o">==</span> <span class="p">[]</span>


<span class="nd">@given</span><span class="p">(</span><span class="n">lists</span><span class="p">(</span><span class="n">integers</span><span class="p">()))</span>
<span class="k">def</span> <span class="nf">test_cumulative_product_starts_with_zero</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">cumulative_product</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="packaging.html" title="previous page">Packaging</a>
    <a class='right-next' id="next-link" href="documentation.html" title="next page">Documentation</a>

              </div>
              
          </main>
          

      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2019-2020 Geoffrey Lentner, 2018 Ashwin Srinath.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.1.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>